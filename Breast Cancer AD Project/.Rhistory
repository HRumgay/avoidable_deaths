df_AD_map<- df_AD_map[order(df_AD_map$int_map_index),]
#For the automatic legend
break_quantile_t <- paste(round(break_quantile,2),"", sep="")
labels_leg <-  c( paste("< ", break_quantile_t[2]),
paste(break_quantile_t[2], " - ", break_quantile_t[3]),
paste(break_quantile_t[3], " - ", break_quantile_t[4]),
paste(break_quantile_t[4], " - ", break_quantile_t[5]),
paste(break_quantile_t[5], " - ", break_quantile_t[6]),
paste(break_quantile_t[6], " - ", break_quantile_t[7]),
paste(break_quantile_t[7], " - ", break_quantile_t[8]),
paste(">= ", break_quantile_t[8]))
labels_leg <- rev(labels_leg)
ggplot() +
geom_polygon(data=df_AD_map,
aes(x=long, y=lat, fill=cutpoint, group = group))+
geom_polygon(data=df_AD_map,
aes(x=long, y=lat, fill=cutpoint, group = group),
colour="grey10",
size = 0.4,
show.legend=FALSE)+
geom_polygon(data=df_AD_map[df_AD_map$id == 82,],
aes(x=long, y=lat, fill=cutpoint, group = group),
colour="grey10",
size = 0.4,
show.legend=FALSE)+
geom_polygon(data=df_map[df_map$id == 59,],
aes(x=long, y=lat, group= group),
fill = "#d6d6d6",
colour="grey10",
size = 0.4,
show.legend=FALSE)+
geom_polygon(data=df_poly[df_poly$poly_fill == 888,],
aes(x=long, y=lat, group = group),
fill = "grey100" ,
show.legend=FALSE)+
geom_polygon(data=df_poly[df_poly$poly_fill == 999,],
aes(x=long, y=lat, group = group),
fill = "#d6d6d6" ,
show.legend=FALSE)+
geom_path(data=df_poly ,
aes(x=long, y=lat, color=line_color, linetype = line_type, group = group),
size = 0.4,
show.legend=FALSE)+
geom_path(data = df_line[df_line$line_color != 0, ],
aes(x=long, y=lat,color=line_color,linetype=line_type,group=group),
size = 0.4,
show.legend=FALSE)+
#      labs(title = paste0(cancer,", ",gender))+
coord_equal() +
theme_opts +
theme(legend.key.width= unit(2.6, "cm"),
legend.key.height= unit(1.4, "cm"),
legend.direction= "vertical",
legend.text = element_text(size=24),
legend.title = element_text(size=24, hjust = 1),
legend.title.align=0.5,
legend.position =c(0.18, -0.02),
legend.background = element_rect(fill="transparent"),
plot.margin = unit(c(0,0,0,0),"lines"))+
scale_fill_manual(name = "Proportion of treatable deaths (%), maximum by HDI group reference",
values= colors_green_GCO,
labels= labels_leg,
na.value = "#cccccc",
drop=FALSE)+
guides(fill = guide_legend(reverse = FALSE))+
scale_color_manual(values=c("grey100", "grey10"))+
scale_linetype_manual(values=c("solid", "11"))->AD_map_max
ggsave("\\\\Inti\\cin\\Studies\\Survival\\SurvCan\\Data\\Oliver_Langselius\\Breast Cancer\\Figures\\map_AD_breast_max_prop.pdf", width = 40, height = 30, pointsize = 12)
ggarrange( AD_map_93, AD_map_max,
labels = c("a)", "b)"),
ncol = 1, nrow = 2,
font.label = list(size = 60, color = "black"))
ggsave("\\\\Inti\\cin\\Studies\\Survival\\SurvCan\\Data\\Oliver_Langselius\\Breast Cancer\\Figures\\map_AD_prop_all_scenarios.pdf", width = 40, height =67, limitsize = FALSE)
AD_by_HDI_all_RF <-Avoidable_Deaths_Simulated_All_RF%>%
dplyr::mutate(age_cat="Overall")%>%
as.data.frame()%>%
droplevels()%>%
ungroup()%>%
dplyr::group_by(hdi_group, cancer, age,sex)%>%
dplyr::mutate(py=sum(py))%>%
ungroup()%>%
select(-country_label,-country_code,-cancer_code, -cancer,  hdi_group,  AD_treat, AD_prev, AD_prev.tob, AD_prev.alc, AD_prev.inf, AD_prev.obe, AD_prev.uv,
AD_unavoid, total_deaths2, AD_sum,-sex, -age, age_cat,-total_overall)%>%
as.data.frame()%>%
droplevels()%>%
ungroup()%>%
dplyr::mutate(hdi_group=as.numeric(hdi_group))%>%
ungroup()%>%
dplyr::group_by(hdi_group)%>%
dplyr::mutate(AD_prev.asr=sum(AD_prev/py*100000*w), #ASR calculation here
AD_prev.tob.asr=sum(AD_prev.tob/py*100000*w), #ASR calculation here
AD_prev.alc.asr=sum(AD_prev.alc/py*100000*w), #ASR calculation here
AD_prev.inf.asr=sum(AD_prev.inf/py*100000*w), #ASR calculation here
AD_prev.obe.asr=sum(AD_prev.obe/py*100000*w), #ASR calculation here
AD_prev.uv.asr=sum(AD_prev.uv/py*100000*w), #ASR calculation here
AD_treat.asr=sum(AD_treat/py*100000*w),
AD_treat_prev.asr=sum((AD_treat+AD_prev)/py*100000*w),
AD_sum.asr=sum(AD_sum/py*100000*w),
#AD_treat_not_prev.asr=sum(AD_treat_not_prev/py*100000*w),
AD_unavoid.asr=sum(AD_unavoid/py*100000*w),
total.deaths.asr=sum(total_deaths2/py*100000*w)) %>%
dplyr::mutate(AD_treat_prev=sum(AD_prev+AD_treat))%>%
dplyr::mutate(total_deaths2=sum(total_deaths2))%>%
dplyr::mutate(AD_treat=sum(AD_treat))%>%
#dplyr::mutate(AD_treat_not_prev=sum(AD_treat_not_prev))%>%
dplyr::mutate(AD_prev=sum(AD_prev))%>%
dplyr::mutate(AD_prev.tob = sum(AD_prev.tob,na.rm=T))%>%
dplyr::mutate(AD_prev.alc = sum(AD_prev.alc,na.rm=T))%>%
dplyr::mutate(AD_prev.inf = sum(AD_prev.inf,na.rm=T))%>%
dplyr::mutate(AD_prev.obe = sum(AD_prev.obe,na.rm=T))%>%
dplyr::mutate(AD_prev.uv = sum(AD_prev.uv,na.rm=T))%>%
dplyr::mutate(AD_unavoid=sum(AD_unavoid))%>%
dplyr::mutate(total_deaths=total_deaths2)%>%
dplyr::mutate(pAD_treat=AD_treat/total_deaths)%>%
#dplyr::mutate(pAD_treat_not_prev=AD_treat_not_prev/total_deaths)%>%
dplyr::mutate(pAD_prev=AD_prev/total_deaths)%>%
dplyr::mutate(pAD_prev.tob=AD_prev.tob/total_deaths)%>%
dplyr::mutate(pAD_prev.alc=AD_prev.alc/total_deaths)%>%
dplyr::mutate(pAD_prev.inf=AD_prev.inf/total_deaths)%>%
dplyr::mutate(pAD_prev.obe=AD_prev.obe/total_deaths)%>%
dplyr::mutate(pAD_prev.uv=AD_prev.uv/total_deaths)%>%
dplyr::mutate(pAD_unavoid=AD_unavoid/total_deaths)%>%
dplyr::mutate(pAD_treat_prev=AD_treat_prev/total_deaths)%>%
dplyr::mutate(cancer="All Cancer Sites")%>%
dplyr::mutate(w=sum(w)/n())%>%
select(-AD_sum,-py)%>%
ungroup()%>%
distinct()%>%
as.data.frame()
AD_by_HDI_all_RF
View(AD_by_HDI_all_RF)
View(Avoidable_Deaths_Simulated_All_age_cat_RF)
View(AD_Region_cancer_sites_RF)
View(AD_Region2_RF)
weights2 <- weights2%>%
dplyr::filter(age>3)%>%
dplyr::mutate(age_cat = case_when(
age>=4 & age<=13~ "15-64",
age>=14 & age<=18~ "65-99",
))%>%
select(-age)%>%
dplyr::mutate(total=sum(w2))%>%
dplyr::group_by(age)%>%
dplyr::mutate(w=sum(w2)/total)%>%
select(-w2, -total)%>%
distinct()
# Weights
w2 <- c(12000,10000,9000,9000,8000,8000,6000,6000,6000,6000,5000,4000,4000,3000,2000,1000,500,500) #SEGI_pop weights
age <- c(1:18)
weights2 <- data.frame(w2, age)
weights2 <- weights2%>%
dplyr::filter(age>3)%>%
dplyr::mutate(age_cat = case_when(
age>=4 & age<=13~ "15-64",
age>=14 & age<=18~ "65-99",
))%>%
select(-age)%>%
dplyr::mutate(total=sum(w2))%>%
dplyr::group_by(age)%>%
dplyr::mutate(w=sum(w2)/total)%>%
select(-w2, -total)%>%
distinct()
weights2 <- weights2%>%
dplyr::filter(age>3)%>%
dplyr::mutate(age_cat = case_when(
age>=4 & age<=13~ "15-64",
age>=14 & age<=18~ "65-99",
))%>%
select(-age)%>%
dplyr::mutate(total=sum(w2))%>%
dplyr::group_by(age_cat)%>%
dplyr::mutate(w=sum(w2)/total)%>%
select(-w2, -total)%>%
distinct()
View(weights2)
pop20202 <- pop2020%>%
as.data.frame()%>%
dplyr::filter(sex==2)%>%
dplyr::filter(age>3)%>%
dplyr::mutate(age_cat = case_when(
age>=4 & age<=13~ "15-64",
age>=14 & age<=18~ "65-99",
))%>%
select(-age)%>%
dplyr::group_by(country_code, age_cat)%>%
dplyr::mutate(py=sum(py))%>%
distinct()%>%
select(-country_label)
pop20202 <- pop2020%>%
as.data.frame()%>%
dplyr::filter(sex==2)%>%
select(-sex)%>%
dplyr::filter(age>3)%>%
dplyr::mutate(age_cat = case_when(
age>=4 & age<=13~ "15-64",
age>=14 & age<=18~ "65-99",
))%>%
select(-age)%>%
dplyr::group_by(country_code, age_cat)%>%
dplyr::mutate(py=sum(py))%>%
distinct()%>%
select(-country_label)
View(pop20202)
Avoidable_Deaths_overall <- Avoidable_Deaths %>%
as.data.frame() %>%
filter(age_cat != "Overall") %>%
filter(!country_label %in% no_overall_upp$country_label) %>%
filter(!country_label %in% no_overall_low$country_label) %>%
mutate(age_cat = "Overall") %>%
ungroup() %>%
group_by(country_code, cancer_code, age_cat) %>%
dplyr::mutate(
#ASRs
AD.asr=sum(AD_treat/py*100000*w),
AD_Lower.asr=sum(AD_treat/py*100000*w),
AD_Upper.asr=sum(AD_treat/py*100000*w),
total_overall = sum(total_overall),
AD = sum(AD),
AD_Lower = sum(AD_Lower),
AD_Upper = sum(AD_Upper),
# AD_med = sum(AD_med),
# AD_Lower_med = sum(AD_Lower_med),
# AD_Upper_med = sum(AD_Upper_med),
AD_max = sum(AD_max),
AD_Lower_max = sum(AD_Lower_max),
AD_Upper_max = sum(AD_Upper_max),
total_deaths = sum(total_deaths)
) %>%
select( country_code,
country_label,
cancer_code,
cancer_label,
total_overall,
AD,
AD_Lower,
AD_Upper,
AD_max,
AD_Lower_max,
AD_Upper_max,
total_deaths,
AD.asr,
AD_Lower.asr,
AD_Upper.asr,
)%>%
distinct() %>%
as.data.frame()
Avoidable_Deaths_overall <- Avoidable_Deaths %>%
as.data.frame() %>%
left_join(pop20202, c("sex", "country_code", "age"))%>%
left_join(weights2)%>%
filter(age_cat != "Overall") %>%
filter(!country_label %in% no_overall_upp$country_label) %>%
filter(!country_label %in% no_overall_low$country_label) %>%
mutate(age_cat = "Overall") %>%
ungroup() %>%
group_by(country_code, cancer_code, age_cat) %>%
dplyr::mutate(
#ASRs
AD.asr=sum(AD_treat/py*100000*w),
AD_Lower.asr=sum(AD_treat/py*100000*w),
AD_Upper.asr=sum(AD_treat/py*100000*w),
total_overall = sum(total_overall),
AD = sum(AD),
AD_Lower = sum(AD_Lower),
AD_Upper = sum(AD_Upper),
# AD_med = sum(AD_med),
# AD_Lower_med = sum(AD_Lower_med),
# AD_Upper_med = sum(AD_Upper_med),
AD_max = sum(AD_max),
AD_Lower_max = sum(AD_Lower_max),
AD_Upper_max = sum(AD_Upper_max),
total_deaths = sum(total_deaths)
) %>%
select( country_code,
country_label,
cancer_code,
cancer_label,
total_overall,
AD,
AD_Lower,
AD_Upper,
AD_max,
AD_Lower_max,
AD_Upper_max,
total_deaths,
AD.asr,
AD_Lower.asr,
AD_Upper.asr,
)%>%
distinct() %>%
as.data.frame()
Avoidable_Deaths_overall <- Avoidable_Deaths %>%
as.data.frame() %>%
left_join(pop20202, by=c("country_code", "age_cat"))%>%
left_join(weights2, by=c("country_code", "age_cat"))%>%
filter(age_cat != "Overall") %>%
filter(!country_label %in% no_overall_upp$country_label) %>%
filter(!country_label %in% no_overall_low$country_label) %>%
mutate(age_cat = "Overall") %>%
ungroup() %>%
group_by(country_code, cancer_code, age_cat) %>%
dplyr::mutate(
#ASRs
AD.asr=sum(AD_treat/py*100000*w),
AD_Lower.asr=sum(AD_treat/py*100000*w),
AD_Upper.asr=sum(AD_treat/py*100000*w),
total_overall = sum(total_overall),
AD = sum(AD),
AD_Lower = sum(AD_Lower),
AD_Upper = sum(AD_Upper),
# AD_med = sum(AD_med),
# AD_Lower_med = sum(AD_Lower_med),
# AD_Upper_med = sum(AD_Upper_med),
AD_max = sum(AD_max),
AD_Lower_max = sum(AD_Lower_max),
AD_Upper_max = sum(AD_Upper_max),
total_deaths = sum(total_deaths)
) %>%
select( country_code,
country_label,
cancer_code,
cancer_label,
total_overall,
AD,
AD_Lower,
AD_Upper,
AD_max,
AD_Lower_max,
AD_Upper_max,
total_deaths,
AD.asr,
AD_Lower.asr,
AD_Upper.asr,
)%>%
distinct() %>%
as.data.frame()
Avoidable_Deaths_overall <- Avoidable_Deaths %>%
as.data.frame() %>%
left_join(pop20202, by=c("country_code", "age_cat"))%>%
left_join(weights2, by=c("age_cat"))%>%
filter(age_cat != "Overall") %>%
filter(!country_label %in% no_overall_upp$country_label) %>%
filter(!country_label %in% no_overall_low$country_label) %>%
mutate(age_cat = "Overall") %>%
ungroup() %>%
group_by(country_code, cancer_code, age_cat) %>%
dplyr::mutate(
#ASRs
AD.asr=sum(AD_treat/py*100000*w),
AD_Lower.asr=sum(AD_treat/py*100000*w),
AD_Upper.asr=sum(AD_treat/py*100000*w),
total_overall = sum(total_overall),
AD = sum(AD),
AD_Lower = sum(AD_Lower),
AD_Upper = sum(AD_Upper),
# AD_med = sum(AD_med),
# AD_Lower_med = sum(AD_Lower_med),
# AD_Upper_med = sum(AD_Upper_med),
AD_max = sum(AD_max),
AD_Lower_max = sum(AD_Lower_max),
AD_Upper_max = sum(AD_Upper_max),
total_deaths = sum(total_deaths)
) %>%
select( country_code,
country_label,
cancer_code,
cancer_label,
total_overall,
AD,
AD_Lower,
AD_Upper,
AD_max,
AD_Lower_max,
AD_Upper_max,
total_deaths,
AD.asr,
AD_Lower.asr,
AD_Upper.asr,
)%>%
distinct() %>%
as.data.frame()
View(weights2)
Avoidable_Deaths_overall <- Avoidable_Deaths %>%
as.data.frame() %>%
left_join(pop20202, by=c("country_code", "age_cat"))%>%
left_join(weights2, by=c("age_cat"))%>%
filter(age_cat != "Overall") %>%
filter(!country_label %in% no_overall_upp$country_label) %>%
filter(!country_label %in% no_overall_low$country_label) %>%
mutate(age_cat = "Overall") %>%
ungroup() %>%
group_by(country_code, cancer_code, age_cat) %>%
dplyr::mutate(
#ASRs
AD.asr=sum(AD_treat/py*100000*w),
AD_Lower.asr=sum(AD_treat/py*100000*w),
AD_Upper.asr=sum(AD_treat/py*100000*w),
total_overall = sum(total_overall),
AD = sum(AD),
AD_Lower = sum(AD_Lower),
AD_Upper = sum(AD_Upper),
# AD_med = sum(AD_med),
# AD_Lower_med = sum(AD_Lower_med),
# AD_Upper_med = sum(AD_Upper_med),
AD_max = sum(AD_max),
AD_Lower_max = sum(AD_Lower_max),
AD_Upper_max = sum(AD_Upper_max),
total_deaths = sum(total_deaths)
) %>%
select( country_code,
country_label,
cancer_code,
cancer_label,
total_overall,
AD,
AD_Lower,
AD_Upper,
AD_max,
AD_Lower_max,
AD_Upper_max,
total_deaths,
AD.asr,
AD_Lower.asr,
AD_Upper.asr,
)%>%
distinct() %>%
as.data.frame()
View(Avoidable_Deaths_overall)
Avoidable_Deaths_overall <- Avoidable_Deaths %>%
as.data.frame() %>%
left_join(pop20202, by=c("country_code", "age_cat"))%>%
left_join(weights2, by=c("age_cat"))%>%
filter(age_cat != "Overall") %>%
filter(!country_label %in% no_overall_upp$country_label) %>%
filter(!country_label %in% no_overall_low$country_label) %>%
mutate(age_cat = "Overall") %>%
ungroup() %>%
group_by(country_code, cancer_code, age_cat) %>%
dplyr::mutate(
#ASRs
AD.asr=sum(AD/py*100000*w),
AD_Lower.asr=sum(AD_Lower/py*100000*w),
AD_Upper.asr=sum(AD_Upper/py*100000*w),
total_overall = sum(total_overall),
AD = sum(AD),
AD_Lower = sum(AD_Lower),
AD_Upper = sum(AD_Upper),
# AD_med = sum(AD_med),
# AD_Lower_med = sum(AD_Lower_med),
# AD_Upper_med = sum(AD_Upper_med),
AD_max = sum(AD_max),
AD_Lower_max = sum(AD_Lower_max),
AD_Upper_max = sum(AD_Upper_max),
total_deaths = sum(total_deaths)
) %>%
select( country_code,
country_label,
cancer_code,
cancer_label,
total_overall,
AD,
AD_Lower,
AD_Upper,
AD_max,
AD_Lower_max,
AD_Upper_max,
total_deaths,
AD.asr,
AD_Lower.asr,
AD_Upper.asr,
)%>%
distinct() %>%
as.data.frame()
View(Avoidable_Deaths_overall)
pop20202 <- pop2020%>%
as.data.frame()%>%
dplyr::filter(sex==2)%>%
select(-sex)%>%
dplyr::filter(age>3)%>%
dplyr::mutate(age_cat = "Overall")%>%
select(-age)%>%
dplyr::group_by(country_code, age_cat)%>%
dplyr::mutate(py=sum(py))%>%
distinct()%>%
select(-country_label)
View(pop20202)
pop202021 <- pop2020%>%
as.data.frame()%>%
dplyr::filter(sex==2)%>%
select(-sex)%>%
dplyr::filter(age>3)%>%
dplyr::mutate(age_cat = case_when(
age>=4 & age<=13~ "15-64",
age>=14 & age<=18~ "65-99",
))%>%
select(-age)%>%
dplyr::group_by(country_code, age_cat)%>%
dplyr::mutate(py=sum(py))%>%
distinct()%>%
select(-country_label)
pop20202 <- pop2020%>%
as.data.frame()%>%
dplyr::filter(sex==2)%>%
select(-sex)%>%
dplyr::filter(age>3)%>%
dplyr::mutate(age_cat = "Overall")%>%
select(-age)%>%
dplyr::group_by(country_code, age_cat)%>%
dplyr::mutate(py=sum(py))%>%
distinct()%>%
select(-country_label)%>%
full_join(pop202021)
